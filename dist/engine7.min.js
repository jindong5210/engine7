/**
 * engine7 
 * 
 * 
 * http://www.engine7.com
 * 
 * Copyright 2017, Jeffrey King
 * 
 * Licensed under MIT
 * 
 * Released on: March 28, 2017
 */
window.Engine7=function(){"use strict";function isNull(e){return null===e||""===e||void 0===e}function ajax(e,t,n,r,i){return $.ajax({url:e,type:t,dataType:"json",data:n,success:r,error:i})}function encodeJSON(e){for(var t in e)e[t]=encodeURIComponent(e[t]);return e}function Engine7(){function Request(element){var req=this;this.url=null,this.params=null,this.method="GET",this.tpl=null,this.dom=null,this.context={},this.invoke=function(){var urlTemplate=Template7.compile(req.url),url=urlTemplate(req.context),params={};if(!isNull(req.params)){var paramsTemplate=Template7.compile(req.params);params=paramsTemplate(req.context);try{params=eval("("+params+")")}catch(e){throw console.error(e),new Error("Can not parse params to JSON. ["+req.id+"].")}"GET"==req.method&&(params=encodeJSON(params))}ajax(url,req.method,params,function(e,t){e.$context=req.context,isNull(req.tpl)||req.tpl.render(e,req.dom)},function(e,t,n){throw console.error(n),new Error("Error occurs when invoking request ["+url+"]")})},this.init=function(){var e=$(element).attr(ATTR_TPL_ID),t=$(element).attr(ATTR_METHOD);if(!isNull(e)){if(req.tpl=engine.templates[e],isNull(req.tpl))throw new Error("Undefined template ["+e+"].");$(element).attr(ATTR_REF,e)}isNull(t)||(req.method=t),req.url=$(element).attr(ATTR_URL),req.params=$(element).attr(ATTR_PARAMS),req.dom=$(element)},this.init()}function Template(e){var t=this;this.id=null,this.src=null,this.render=function(e,n){var r=Template7.compile(t.src),i=r(e),a=$(i),s=a.filter("["+ATTR_URL+"]");n.append(a),s.each(function(){var t=new Request(this);t.context=e,t.invoke()})},this.init=function(){if(t.id=$(e).attr("id"),t.src=$(e).html(),isNull(t.id))throw new Error("ID is undefined in template.")},this.init()}var engine=this,ATTR_TPL_ID="data-tpl-id",ATTR_URL="data-api-url",ATTR_METHOD="data-api-method",ATTR_PARAMS="data-api-param",ATTR_CACHED="data-api-cached",ATTR_REF="data-tpl-ref";this.requests=[],this.templates={},this.invokeAll=function(){for(var e=0;e<engine.requests.length;e++){engine.requests[e].invoke()}},this._initTemplates=function(){$("script[type='text/template7']").each(function(e){var t=new Template(this);engine.templates[t.id]=t})},this._initRequests=function(){$("["+ATTR_URL+"]").each(function(){var e=new Request(this);engine.requests.push(e)})},this._initTemplates(),this._initRequests(),this.invokeAll()}var e7=new Engine7;return e7}();
//# sourceMappingURL=engine7.min.js.map
