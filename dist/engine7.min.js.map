{"version":3,"sources":["engine7.js"],"names":["window","Engine7","isNull","str","undefined","getArrayIndex","arr","e","i","length","encodeJSON","json","key","encodeURIComponent","Request","element","req","this","id","url","params","method","tpl","dom","context","handleSuccess","data","status","afterInvokeEventCB","engine","events","afterInvoke","$context","render","handleError","xhr","error","invokeError","console","Error","errorEventCB","invoke","urlTemplate","Template7","compile","paramsTemplate","eval","options","type","dataType","success","beforeInvokeEventCB","beforeInvoke","$","ajax","done","tasks","init","tplId","attr","ATTR_TPL_ID","ATTR_METHOD","ATTR_ID","templates","ATTR_REF","ATTR_URL","ATTR_PARAMS","Template","src","srcTemplate","beforeRenderEventCB","beforeRender","html","els","append","afterRenderEventCB","afterRender","reqdoms","filter","each","completeCB","Form","form","INPUT_TYPE","action","elements","putElJSON","name","value","split","node","shift","last","tmp","push","toJSON","el","tag","tagName","val","is","submitBackEventCB","submitBack","submitErrorEventCB","submitError","submit","beforeSubmitEventCB","beforeSubmit","find","removeAttr","ATTR_TEMPLATE7","ATTR_AJAX_FORM","requests","forms","_invokeAll","complete","cb","_initForms","onBeforeRender","onAfterRender","onBeforeInvoke","reqId","onAfterInvoke","onInvokeError","onBeforeSubmit","formId","onSubmitBack","onSubmitError","_init","template","request","e7"],"mappings":"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","file":"engine7.min.js","sourcesContent":["/**\n * engine7 \n * \n * \n * https://github.com/jindong5210/engine7\n * \n * Copyright 2017, Jeffrey King\n * \n * Licensed under MIT\n * \n * Released on: March 29, 2017\n */\nwindow.Engine7 = (function() {\n    'use strict';\n\n    function isNull(str) {\n        return str === null || str === \"\" || str === undefined;\n    }\n\n    function getArrayIndex(arr,e) {\n        for(var i=0; i<arr.length; i++){\n            if(arr[i] == e){\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function encodeJSON(json){\n        for (var key in json) {\n            json[key] = encodeURIComponent(json[key]);\n        }\n        return json;\n    }\n\n    function Engine7(){\n        var engine = this;\n\n        var ATTR_TEMPLATE7 = \"text/template7\";\n        var ATTR_ID = \"id\";\n        var ATTR_TPL_ID = \"data-tpl-id\";\n        var ATTR_URL = \"data-api-url\";\n        var ATTR_METHOD = \"data-api-method\";\n        var ATTR_PARAMS = \"data-api-param\";\n        var ATTR_REF = \"data-tpl-ref\";\n        var ATTR_AJAX_FORM = \"data-ajax-form\";\n\n        this.requests = [];\n        this.templates = {};\n        this.forms = {};\n        this.tasks = 0;\n        this.completeCB = null;\n        this.events = {\n            beforeInvoke : {},\n            afterInvoke : {},\n            beforeRender : {},\n            afterRender : {},\n            invokeError : {},\n            beforeSubmit : {},\n            submitBack : {},\n            submitError : {},\n        };\n\n        function Request(element){\n            var req = this;\n            this.id = null;\n            this.url = null;\n            this.params = null;\n            this.method = \"GET\";\n            this.tpl = null;\n            this.dom = null;\n            this.context = {};\n            this.handleSuccess = function(data, status){\n                if(!isNull(req.id)){\n                    var afterInvokeEventCB = engine.events.afterInvoke[req.id];\n                    if(!isNull(afterInvokeEventCB)){\n                        afterInvokeEventCB(data, status, req);\n                    }\n                }\n                data.$context = req.context;\n                if(!isNull(req.tpl)){\n                    req.tpl.render(data, req.dom);\n                }\n            };\n            this.handleError = function (xhr, status, error) {\n                if(!isNull(req.id) && !isNull(engine.events.invokeError[req.id])){\n                    var errorEventCB = engine.events.invokeError[req.id];\n                    if(!isNull(errorEventCB)){\n                        errorEventCB(xhr, status, error, req);\n                    }\n                }else{\n                    console.error(error);\n                    throw new Error(\"Error occurs when invoking request [\" + req.url + \"]\");\n                }\n\n            };\n            this.invoke = function(){\n\n                var urlTemplate = Template7.compile(req.url);\n                var url = urlTemplate(req.context);\n                var params = {};\n                if(!isNull(req.params)){\n                    var paramsTemplate = Template7.compile(req.params);\n                    params = paramsTemplate(req.context);\n                    try {\n                        params = eval(\"(\" + params + \")\");\n                    } catch (e) {\n                        console.error(e);\n                        throw new Error(\"Can not parse params to JSON. [\"+ req.id + \"].\");\n                    }\n                    if(req.method == \"GET\"){\n                        params = encodeJSON(params);\n                    }\n                }\n                var options = {\n                    url : url,\n                    type : req.method,\n                    dataType: \"json\",\n                    data : params,\n                    success : req.handleSuccess,\n                    error : req.handleError\n                };\n                if(!isNull(req.id)){\n                    var beforeInvokeEventCB = engine.events.beforeInvoke[req.id];\n                    if(!isNull(beforeInvokeEventCB)){\n                        beforeInvokeEventCB(options, req);\n                    }\n                }\n\n                $.ajax(options).done(function(){\n                    engine.tasks--;\n                });\n                engine.tasks ++;\n            };\n            this.init = function(){\n                var tplId = $(element).attr(ATTR_TPL_ID);\n                var method = $(element).attr(ATTR_METHOD);\n                var id = $(element).attr(ATTR_ID);\n                if(!isNull(tplId)){\n                    req.tpl = engine.templates[tplId];\n                    if(isNull(req.tpl)){\n                        throw new Error(\"Undefined template [\" + tplId + \"].\");\n                    }\n                    $(element).attr(ATTR_REF,tplId);\n                }\n                if(!isNull(method)){\n                    req.method = method;\n                }\n                if(!isNull(id)){\n                    req.id = id;\n                }\n                req.url = $(element).attr(ATTR_URL);\n                req.params = $(element).attr(ATTR_PARAMS);\n                req.dom = $(element);\n\n            };\n            this.init();\n        }\n\n        function Template(element){\n            var tpl = this;\n            this.id = null;\n            this.src = null;\n\n\n            this.render = function (context, dom) {\n\n                var srcTemplate = Template7.compile(tpl.src);\n\n                var beforeRenderEventCB = engine.events.beforeRender[tpl.id];\n                if(!isNull(beforeRenderEventCB)){\n                    beforeRenderEventCB(context,tpl);\n                }\n\n                var html = srcTemplate(context);\n                var els = $(html);\n                dom.append(els);\n\n                var afterRenderEventCB = engine.events.afterRender[tpl.id];\n                if(!isNull(afterRenderEventCB)){\n                    afterRenderEventCB(els,tpl);\n                }\n\n                var reqdoms = els.filter(\"[\" + ATTR_URL + \"]\");\n                reqdoms.each(function () {\n                    var req = new Request(this);\n                    req.context = context;\n                    req.invoke();\n                });\n\n                if(engine.tasks === 1 && reqdoms.length === 0){\n                    engine.completeCB();\n                }\n\n            };\n            this.init = function(){\n                tpl.id = $(element).attr(\"id\");\n                tpl.src = $(element).html();\n                if(isNull(tpl.id)){\n                    throw new Error(\"ID is required on template.\");\n                }\n            };\n            this.init();\n        }\n        \n        function Form(element) {\n            var form = this;\n\n            var INPUT_TYPE = [\"text\",\"hidden\",\"password\",\"checkbox\",\"radio\"];\n\n            this.id = null;\n            this.action = null;\n            this.method = \"GET\";\n            this.elements = [];\n\n            this.putElJSON = function (json, name, value) {\n                var arr = name.split(/\\./);\n                var obj = {};\n                while(arr.length > 1){\n                    var node = arr.shift();\n                    if(!json[node]){\n                        json[node] = {};\n                    }\n                    json = json[node];\n                }\n                var last = arr[arr.length - 1];\n                if(json[last]){\n                    var tmp = [json[last]];\n                    tmp.push(value);\n                    json[last] = tmp;\n                }else{\n                    json[last] = value;\n                }\n            };\n\n            this.toJSON = function () {\n                var json = {};\n                    for(var i=0; i<form.elements.length; i++){\n                    var el = form.elements[i];\n                    var tag = el.tagName;\n                    var type = $(el).attr(\"type\");\n                    var name = $(el).attr(\"name\");\n                    var val = $(el).val();\n                    if(tag === \"INPUT\" && (type === \"checkbox\" || type === \"radio\")){\n                        if(!$(el).is(':checked')) {\n                            continue;\n                        }\n                    }\n                    form.putElJSON(json, name, val);\n                }\n                return json;\n            };\n            this.handleSuccess = function(data, status){\n                var submitBackEventCB = engine.events.submitBack[form.id];\n                if(!isNull(submitBackEventCB)){\n                    submitBackEventCB(data, status, form);\n                }\n            };\n            this.handleError = function (xhr, status, error) {\n                var submitErrorEventCB = engine.events.submitError[form.id];\n                if(!isNull(submitErrorEventCB)){\n                    submitErrorEventCB(xhr, status, error, form);\n                }else{\n                    console.error(error);\n                    throw new Error(\"Error occurs when submit form [\" + form.id + \"]\");\n                }\n\n            };\n            this.submit = function () {\n                var json = form.toJSON();\n                var beforeSubmitEventCB = engine.events.beforeSubmit[form.id];\n                if(!isNull(beforeSubmitEventCB)){\n                    beforeSubmitEventCB(json, form);\n                }\n\n                var options = {\n                    url : form.action,\n                    type : form.method,\n                    dataType: \"json\",\n                    data : json,\n                    success : form.handleSuccess,\n                    error : form.handleError\n                };\n\n                $.ajax(options).done(function(){\n                    $(element).find(\"input[type='submit']\").removeAttr(\"disabled\");\n                });\n            };\n            this.init = function () {\n                form.id = $(element).attr(\"id\");\n                form.action = $(element).attr(\"action\");\n\n                if(isNull(form.id)){\n                    throw new Error(\"ID is required on data-ajax-form.\");\n                }\n                if(isNull(form.action)){\n                    throw new Error(\"Action is required on data-ajax-form.\");\n                }\n                var method = $(element).attr(\"method\");\n                if(!isNull(method)){\n                    form.method = method;\n                }\n                $(element).find(\"input,textarea,select\").each(function () {\n                    var name = $(this).attr(\"name\");\n                    var type = $(this).attr(\"type\");\n                    var tag = this.tagName;\n                    if(!isNull(name)){\n                        if(tag === \"INPUT\" && getArrayIndex(INPUT_TYPE, type) < 0){//Not supported\n                            return true;\n                        }\n                        form.elements.push(this);\n                    }\n                });\n                $(element).submit(function () {\n                    $(element).find(\"input[type='submit']\").attr(\"disabled\",\"disabled\");\n                    form.submit();\n                    return false;\n                });\n            };\n            this.init();\n        }\n\n        this._invokeAll = function(){\n            for(var i = 0;i < engine.requests.length; i++){\n                var req = engine.requests[i];\n                req.invoke();\n            }\n            if(engine.requests.length === 0){\n                engine.completeCB();\n            }\n        };\n\n        this.complete = function(cb){\n            engine.completeCB = function () {\n                engine._initForms();\n                if(cb){\n                    cb();\n                }\n            };\n            engine._invokeAll();\n        };\n\n        this.onBeforeRender = function(tplId, cb){\n            engine.events.beforeRender[tplId] = cb;\n        };\n\n        this.onAfterRender = function(tplId, cb){\n            engine.events.afterRender[tplId] = cb;\n        };\n\n        this.onBeforeInvoke = function(reqId, cb){\n            engine.events.beforeInvoke[reqId] = cb;\n        };\n\n        this.onAfterInvoke = function(reqId, cb){\n            engine.events.afterInvoke[reqId] = cb;\n        };\n\n        this.onInvokeError = function(reqId, cb){\n            engine.events.invokeError[reqId] = cb;\n        };\n\n        this.onBeforeSubmit = function (formId, cb) {\n            engine.events.beforeSubmit[formId] = cb;\n        };\n\n        this.onSubmitBack = function (formId, cb) {\n            engine.events.submitBack[formId] = cb;\n        };\n\n        this.onSubmitError = function (formId, cb) {\n            engine.events.submitError[formId] = cb;\n        };\n\n        this._init = function(){\n            $(\"script[type='\" + ATTR_TEMPLATE7 + \"']\").each(function(i) {\n                var template = new Template(this);\n                engine.templates[template.id] = template;\n            });\n\n            $(\"[\" + ATTR_URL + \"]\").each(function() {\n                var request = new Request(this);\n                engine.requests.push(request);\n            });\n        };\n\n        this._initForms = function () {\n            $(\"[\" + ATTR_AJAX_FORM + \"]\").each(function() {\n                var form = new Form(this);\n                engine.forms[form.id] = form;\n            });\n        };\n\n        this._init();\n\n    }\n\n    var e7 = new Engine7();\n    return e7;\n\n})();\n\n//# sourceMappingURL=engine7.js.map\n"]}